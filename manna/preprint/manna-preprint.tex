\documentclass[10pt,twocolumn,fleqn]{article}
\usepackage{geometry}
\geometry{letterpaper,margin=1.5cm}

\usepackage[parfill]{parskip}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{authblk}

\usepackage{tikz, tkz-graph}
\usepackage{pgfplots}
\usepackage{pgfcb}
\pgfplotsset{
  every axis legend/.append style={draw=none, fill=black!2, cells = {anchor=west}, font = \small},
  every axis grid/.append style = {color=black!60, dotted}
}

\usepackage[style=nature,doi=false,url=false,isbn=false]{biblatex}
\bibliography{/home/tpoisot/texmf/bibtex/bib/local/library.bib}

\title{The dynamics of neutral and trait-based multi-trophic interactions}
\date{}

\author[1,2]{Timoth\'ee Poisot}
\author[1,2]{Dominique Gravel}

\affil[1]{Universit\'e du Qu\'ebec \`a Rimouski, Rimouski, Canada.}
\affil[2]{Quebec Center for Biodiversity Science, McGill University, Montr\'eal, Canada.}
\affil[*]{email: \texttt{timothee.poisot@uqar.ca}}

\begin{document}

\maketitle

\begin{abstract}
We describe \emph{manna}, a simple modeling framework of individuals
establishing trophic interactions under neutral or trait-based rules. We use
this model to show that neutral and trait-based interactions differ in their
temporal dynamics, and discuss how our results contribute to highlighting the
need to understand spatial and temporal dynamics of species interaction
networks.
\end{abstract}

\section{Introduction}

Species intetraits and neutral effects on networks

need to account for dynamics through space and time

simple modelling framework

main results: turnover of pred/prey, contribution to sp turnover, role of connectance

\section{The model}

We define an individual based model of multi-trophic interactions in a single
patch. Species are defined by a vector of functional traits, them being their
niche position ($\mathbf{n}_i$), the centroid of their feeding range
($\mathbf{c}_i$), the breadth of their range ($\mathbf{r}_i$), and their
maximal population size ($\mathbf{K}_i$).

Some words on the logic

\subsection{Generation of the species pool}

The species pool is generated so as to obtain a number of species $S$, with an
expected connectance value of $Co$. To generate the species pool, we draw at
random in an uniform distribution ranging from 0 to 1, $S$ values forming the
vector $\mathbf{n}$. The vectors $\mathbf{c}$ and $\mathbf{r}$ are generated
following the method described by \textcite{williams_simple_2000}. \textbf{Say more.} The number of
individuals in each species is $\mathbf{p}_i$

As a final step, the values of $\mathbf{K}_i$ are drawn at random from the
uniform distribution between 0 and $K_{\mathrm{max}}(i)$, where
$K_{\mathrm{max}}(i)$ is simply $10^3\times(1-\mathbf{n}_i)+100$. This way,
species with the large $\mathbf{n}_i$ have lower carrying capacity, and
species with low $\mathbf{n}_i$ have high carrying capacity. This accounts for
the well known negative relationship between trophic rank and population size.
To initialize the simulation, a number of individuals $\mathbf{p}_i$ is drawn
from the uniform distribution from $10$ to $\mathbf{K}_i$.

\subsection{Simulation}

Before the interactions happen and the demographic changes are calculated,
there is a (possible) immigration step, to implicitely simulate some spatial
context and maintain species richness. The identity of the species receiving
each migrant is drawn at random. This makes it so that locally extinct species
can be rescued through immigration. After the immigration is over, the
probability that each individual will reproduce or die is calculated given the
following set of rules. The mortality probability of individual $i$ is

\begin{equation}
	m_i = \mu+s_ic_\mu
\end{equation}

\noindent, while its natality probability is 

\begin{equation}
	b_i = \nu-s_ic_\nu
\end{equation}

\noindent, and $s_i$ is a scaling factor related to the niche position, wherein

\begin{equation}
	1-(1-\mathbf{n}_i)^k
\end{equation}

\noindent. The exponent $k$ regulates the strength of the scaling. The
population size of species $i$ at time $t+1$ is calculated as

\begin{equation}
	\mathrm{min}(\mathbf{K}_i, \mathbf{p}_i - \mathcal{B}(m_i, \mathbf{p}_i) + \mathcal{B}(b_i, \mathbf{p}_i))
\end{equation}

\noindent, where $\mathcal{B}(p,n)$ is the number of successes of a Bernoulli
process with probability of success of $p$ and $n$ trials.

After the demographic changes are done, we pick at random 15\% of the
individuals, which will be seeking a prey at this timestep. Each indiviual has
an equal probability of being picked, so that species with high abundances
will be over-represented among the pools of predators. The identity of preys
items is detailed in the next two sub-sections. The interactions are done on
an individual basis, meaning that we pick a predator, then its prey, and
reproduce this routine once we have reached enough predators.

\subsection{Neutral interactions}

In the neutral scenario, the only factor regulating the identity of the prey
is its abundance. Once the predating individual is selected, we pick at random
one individual from any species (including the possibility of cannibalism) in
the pool. The predated individual is then removed.

\subsection{Trait-based interactions}

In the trait-based scenario, preys are selected only among the species which
can be fed upon, as in the \emph{niche} model of \textcite{williams_simple_2000}. Preys are still
selected on the basis of their abundances, \emph{i.e.} relative to the
abundance of all other preys falling within the feeding range of the predator.

\begin{figure}[tb]
	\begin{center}
		\input{figure_web_neutre.tex}
		\hskip 1em%
		\input{figure_web_niche.tex}
	\end{center}
	\caption{Comparison of the structure of networks under the neutral (left) and trait-based (right) approaches. When the only rule for the existence of an interaction is that the two populations are large enough to interact (neutral rules), we expect more interactions than when traits are used to delineate a feeding range (trait-based rules). These trait-forbidden links are dashed in the right network. Switching from one situation to the other can lead to complex effects, both on networks dyamics and community composition.}
	\label{fig:nitr}
\end{figure}

\subsection{Implementation and availability}

A C99 implementation of the model, using the Gnu Scientific Library, is
available at \texttt{https://github.com/tpoisot/ms\_pop\_networks/}, under the conditions of the GNU GPL
licence.

\section{Methods}

\subsection{Simulations}

We used the model to generate species pools of size $S = 50$, with connectance
varying from $0.01$ to $0.5$ by varying increments choosen to represent the
changes induced by connectance. 5 individuals migrated into the system at each
timestep. Each community is simulated under the neutral and trait based
assumptions, and replicated 20 times. Simulations are done over $5\times 10^3$
timesteps, as preliminary analyses showed it was long enough to reach an
equilibrium in number of persisting species, number of persisting links, and
overtime dissimilarity.

\subsection{Analyses}

Networks where aggregated in bins of 10 timesteps for the analysis
(exploratory work showed that the bin size made no quantitative difference on
the results, though it did considerably speed up the calculations). Within
each bin, we measure the number of species in the network ($\mathcal{S}$), the
number of links ($\mathcal{L}$), the effective connectance ($\mathcal{C}$, expressed as
$\mathcal{L}/\mathcal{S}^2$).

Within each run of the simulation, we measure components of network
dissimilarity through time, using the method described in
\textcite{poisot_dissimilarity_2012}. We measure turnover of interactions and
community structure between the network at time $t$ and the network at time
$t+1$. We report the overal network dissimilarity ($\beta_{WN}$), the
dissimilarity of links across shared species ($\beta_{OS}$), the species
turnover ($\beta_{S}$), and its contribution to network turnover
($\beta_{\mathrm{contrib}}$). In addition, we report the turnover of predators
($\beta_{U}$) and preys ($\beta_{L}$) through time.

\section{Results}

\subsection{Community dynamics}

\begin{figure}[tb]
	\begin{center}
		\begin{tikzpicture} %% Part 1: Species
			\begin{axis}[height=5cm, width=0.9\columnwidth,
			xmin = 0, xmax = 2500, xlabel=Timestep,
			ymin = 0, ymax = 50, ylabel=Number of unique species,
			grid=major]
			\addplot+[mark=none,solid,color=black,very thick] table [x=t,y=sp] {./figures/dyn-0.1.neutral.dat};
			\addlegendentry{Neutral};
			\addplot+[mark=none,solid,color=Spectral1,thick] table [x=t,y=sp] {./figures/dyn-0.01.trait.dat};
			\addlegendentry{$Co = 1\times10^{-2}$};
			\addplot+[mark=none,solid,color=Spectral3,thick] table [x=t,y=sp] {./figures/dyn-0.05.trait.dat};
			\addlegendentry{$Co = 5\times10^{-2}$};
			\addplot+[mark=none,solid,color=Spectral5,thick] table [x=t,y=sp] {./figures/dyn-0.1.trait.dat};
			\addlegendentry{$Co = 1\times10^{-1}$};
			\addplot+[mark=none,solid,color=Spectral7,thick] table [x=t,y=sp] {./figures/dyn-0.2.trait.dat};
			\addlegendentry{$Co = 2\times10^{-1}$};
			\addplot+[mark=none,solid,color=Spectral9,thick] table [x=t,y=sp] {./figures/dyn-0.5.trait.dat};
			\addlegendentry{$Co = 5\times10^{-1}$};
			\end{axis}
		\end{tikzpicture}
		\begin{tikzpicture} %% Part 2: Links
			\begin{axis}[height=5cm, width=0.9\columnwidth,
			xmin = 0, xmax = 2500, xlabel=Timestep,
			ymin = 0, ymax = 80, ylabel=Number of interactions,
			grid=major]
			\addplot+[mark=none,solid,color=black,very thick] table [x=t,y=li] {./figures/dyn-0.1.neutral.dat};
			\addplot+[mark=none,solid,color=Spectral1,thick] table  [x=t,y=li] {./figures/dyn-0.01.trait.dat};
			\addplot+[mark=none,solid,color=Spectral3,thick] table  [x=t,y=li] {./figures/dyn-0.05.trait.dat};
			\addplot+[mark=none,solid,color=Spectral5,thick] table  [x=t,y=li] {./figures/dyn-0.1.trait.dat};
			\addplot+[mark=none,solid,color=Spectral7,thick] table  [x=t,y=li] {./figures/dyn-0.2.trait.dat};
			\addplot+[mark=none,solid,color=Spectral9,thick] table  [x=t,y=li] {./figures/dyn-0.5.trait.dat};
			\end{axis}
		\end{tikzpicture}
		\begin{tikzpicture} %% Part 3: Connectance
			\begin{axis}[height=5cm, width=0.9\columnwidth,
			xmin = 0, xmax = 2500, xlabel=Timestep,
			ymin = 0, ymax = 0.4, ylabel=Connectance,
			grid=major]
			\addplot+[mark=none,solid,color=black,very thick] table [x=t,y=co] {./figures/dyn-0.1.neutral.dat};
			\addplot+[mark=none,solid,color=Spectral1,thick] table  [x=t,y=co] {./figures/dyn-0.01.trait.dat};
			\addplot+[mark=none,solid,color=Spectral3,thick] table  [x=t,y=co] {./figures/dyn-0.05.trait.dat};
			\addplot+[mark=none,solid,color=Spectral5,thick] table  [x=t,y=co] {./figures/dyn-0.1.trait.dat};
			\addplot+[mark=none,solid,color=Spectral7,thick] table  [x=t,y=co] {./figures/dyn-0.2.trait.dat};
			\addplot+[mark=none,solid,color=Spectral9,thick] table  [x=t,y=co] {./figures/dyn-0.5.trait.dat};
			\end{axis}
		\end{tikzpicture}
	\end{center}
	\caption{Temporal dynamics of network structure, as a function of wether the system behaves neutrally (black lines) or under trait-based rules (colored lines). The first 2500 timesteps are shown, all simulations reached equilibrium at approx. $t = 1000$. \textbf{A.} Number of unique species ($\mathcal{S}$). \textbf{B.} Number of unique interactions ($\mathcal{L}$) \textbf{C.} Connectance of the network ($\mathcal{C}$).}
	\label{f:comdyn}
\end{figure}

Regardless of the rules or connectance, all simulation conditions yield a common pattern: a rapid decrease is the number of species (\emph{i.e.} sorting) and links (Fig.~\ref{f:comdyn}). This results in changes in connectance, with all the simulations eventually stabilizing around a value of $\mathcal{C}\approx 0.05$. The number of species maintained is higher in the neutral conditions. When connectance increases, the number of persisting species increasing as well. For a connectance of $\mathrm{Co} = 0.5$, there are almost no differences in species richness between the neutral and trait-based situations. The same is true of the number of interactions.

\subsection{Networks dynamics}

%% Figure : temporal dynamics of network turnover

%% Table : summary of the network turnover measures over the last 100 timesteps


%% Figure : temporal dynamics of network turnover

\begin{figure}[tb]
	\begin{center}
		\begin{tikzpicture} %% Part 1: whole network
			\begin{axis}[height=5cm, width=0.9\columnwidth,
			xmin = 0, xmax = 2500, xlabel=Timestep,
			ymin = 0, ymax = 1, ylabel=Whole network dissimilarity,
			grid=major]
			\addplot+[mark=none,solid,color=black,very thick] table [x=t,y=WN] {./figures/beta-0.1.neutral.dat};
			\addlegendentry{Neutral};
			\addplot+[mark=none,solid,color=Spectral1,thick] table [x=t,y=WN] {./figures/beta-0.01.trait.dat};
			\addlegendentry{$Co = 1\times10^{-2}$};
			\addplot+[mark=none,solid,color=Spectral3,thick] table [x=t,y=WN] {./figures/beta-0.05.trait.dat};
			\addlegendentry{$Co = 5\times10^{-2}$};
			\addplot+[mark=none,solid,color=Spectral5,thick] table [x=t,y=WN] {./figures/beta-0.1.trait.dat};
			\addlegendentry{$Co = 1\times10^{-1}$};
			\addplot+[mark=none,solid,color=Spectral7,thick] table [x=t,y=WN] {./figures/beta-0.2.trait.dat};
			\addlegendentry{$Co = 2\times10^{-1}$};
			\addplot+[mark=none,solid,color=Spectral9,thick] table [x=t,y=WN] {./figures/beta-0.5.trait.dat};
			\addlegendentry{$Co = 5\times10^{-1}$};
			\end{axis}
		\end{tikzpicture}\hfill%
		\begin{tikzpicture} %% Part 2: OS
			\begin{axis}[height=5cm, width=0.9\columnwidth,
			xmin = 0, xmax = 2500, xlabel=Timestep,
			ymin = 0, ymax = 1, ylabel=Common species dissimilarity,
			grid=major]
			\addplot+[mark=none,solid,color=black,very thick] table [x=t,y=OS] {./figures/beta-0.1.neutral.dat};
			\addplot+[mark=none,solid,color=Spectral1,thick] table  [x=t,y=OS] {./figures/beta-0.01.trait.dat};
			\addplot+[mark=none,solid,color=Spectral3,thick] table  [x=t,y=OS] {./figures/beta-0.05.trait.dat};
			\addplot+[mark=none,solid,color=Spectral5,thick] table  [x=t,y=OS] {./figures/beta-0.1.trait.dat};
			\addplot+[mark=none,solid,color=Spectral7,thick] table  [x=t,y=OS] {./figures/beta-0.2.trait.dat};
			\addplot+[mark=none,solid,color=Spectral9,thick] table  [x=t,y=OS] {./figures/beta-0.5.trait.dat};
			\end{axis}
		\end{tikzpicture}
		\begin{tikzpicture} %% Part 3: S
			\begin{axis}[height=5cm, width=0.9\columnwidth,
			xmin = 0, xmax = 2500, xlabel=Timestep,
			ymin = 0, ymax = 1, ylabel=Species dissimilarity,
			grid=major]
			\addplot+[mark=none,solid,color=black,very thick] table [x=t,y=S] {./figures/beta-0.1.neutral.dat};
			\addplot+[mark=none,solid,color=Spectral1,thick] table  [x=t,y=S] {./figures/beta-0.01.trait.dat};
			\addplot+[mark=none,solid,color=Spectral3,thick] table  [x=t,y=S] {./figures/beta-0.05.trait.dat};
			\addplot+[mark=none,solid,color=Spectral5,thick] table  [x=t,y=S] {./figures/beta-0.1.trait.dat};
			\addplot+[mark=none,solid,color=Spectral7,thick] table  [x=t,y=S] {./figures/beta-0.2.trait.dat};
			\addplot+[mark=none,solid,color=Spectral9,thick] table  [x=t,y=S] {./figures/beta-0.5.trait.dat};
			\end{axis}
		\end{tikzpicture}\hfill%
		\begin{tikzpicture} %% Part 4: contrib
			\begin{axis}[height=5cm, width=0.9\columnwidth,
			xmin = 0, xmax = 2500, xlabel=Timestep,
			ymin = 0, ymax = 1, ylabel=Contribution of sp. turnover,
			grid=major]
			\addplot+[mark=none,solid,color=black,very thick] table [x=t,y=contrib] {./figures/beta-0.1.neutral.dat};
			\addplot+[mark=none,solid,color=Spectral1,thick] table  [x=t,y=contrib] {./figures/beta-0.01.trait.dat};
			\addplot+[mark=none,solid,color=Spectral3,thick] table  [x=t,y=contrib] {./figures/beta-0.05.trait.dat};
			\addplot+[mark=none,solid,color=Spectral5,thick] table  [x=t,y=contrib] {./figures/beta-0.1.trait.dat};
			\addplot+[mark=none,solid,color=Spectral7,thick] table  [x=t,y=contrib] {./figures/beta-0.2.trait.dat};
			\addplot+[mark=none,solid,color=Spectral9,thick] table  [x=t,y=contrib] {./figures/beta-0.5.trait.dat};
			\end{axis}
		\end{tikzpicture}
	\end{center}
	\caption{Temporal dynamics of network turnover, as a function of wether the system behaves neutrally (black lines) or under trait-based rules (colored lines). The first 2500 timesteps are shown, all simulations reached equilibrium at approx. $t = 1000$. \textbf{A.} Whole-network dissimilarity ($\beta_{WN}$) remains high under the neutral scenario. \textbf{B.} The same is true of interaction turnover across shared species, $\beta_{OS}$. \textbf{C.} Species turnover displays a hump-shaped pattern with connectance (see also {\color{red}FIGURE XXX}). \textbf{D.} The impact of species turnover on interactions turnover is low is the neutral model, but increasingly higher when trait-based rules are used and connectance decreases.}
	\label{f:netdyn}
\end{figure}

\section{Discussion}

1. summary of the differences

2. inferring mechanisms with temporal dynamics

3. role of connectance

\printbibliography

\end{document}
